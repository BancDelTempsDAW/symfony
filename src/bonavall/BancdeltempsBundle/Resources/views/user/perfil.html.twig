{% extends 'bonavallBancdeltempsBundle:Default:skel.html.twig' %}
{% block body %}

<style>
    #success,#failure {
        opacity: 1;
        font-size: 21px;
        text-align: center;
        display:block; 
        position:absolute; 
        top:50%; 
        left:60%; 
        margin-top:-150px; 
        margin-left:-300px;
    }
    #checkForm label.error {
        color: #FB3A3A;
        display: inline-block;
        margin: 4px 0 5px 125px;
        padding: 0;
        text-align: left;
        width: 220px;
    }
</style>

<script src="{{ asset('js/validate/dist/jquery.validate.min.js') }}" type="text/javascript"></script>
<script src="{{ asset('js/validate/dist/jquery.validate.js') }}" type="text/javascript"></script>

<form id="checkForm" method="post" >

    <div style="width: 300px" >

        <label for="fotografia">Fotografia:</label>
        <input id="user_fotografia" type="file" name="user_fotografia" />

        <label for="nom">Password:</label>
        <input id="user_pass" type="password" value="{{ app.user.password }}" name="user_pass" class="form-control" />

        <label for="nom">Confirmació del password:</label>
        <input id="user_passRepeat" type="password" name="user_passRepeat" class="form-control" />

        <label for="nom">Nom:</label>
        <input id="user_nom" type="text" name="user_nom" value="{{ app.user.nom }}" placeholder="{{ app.user.nom }}" class="form-control" />

        <label for="cognom">Cognom:</label>
        <input id="user_cognom" type="text" name="user_cognom" value="{{ app.user.cognom }}" placeholder="{{ app.user.cognom }}" class="form-control" />

        <label for="adreca">Adreça:</label>
        <input id="user_adreca" type="text" name="user_adreca" value="{{ app.user.adreca }}" placeholder="{{ app.user.adreca }}" class="form-control" />

        <label for="telefon">Telefon:</labe>
        <input id="user_telefon" type="text" name="user_telefon" value="{{ app.user.telefon }}" placeholder="{{ app.user.telefon }}" class="form-control" />

        <label for="email">Email:</label>
        <input id="user_email" type="text" name="user_email" value="{{ app.user.email }}" placeholder="{{ app.user.email}}" class="form-control" />

        <label for="punts">Punts:</label>
        <input id="user_punts" type="text" name="user_punts" value="{{ app.user.punts }}" placeholder="{{ app.user.nom }}" readonly="" class="form-control" />

        <label for="presentacio">Presentació:</label>
        <textarea id="user_presentacio" type="text" name="user_presentacio" class="form-control" style="width: 400px; height: 100px">{{ app.user.presentacio }}</textarea>

        <div id="optionsPerfil" >

            <input type="submit" id="botoModificarPerfil" name="modificarPerfil" class="btn btn-primary"   value="Modificar perfil" style="height: 34px; width: 200px; margin-top: 10px" />
{#            <a id="botoUserBaixa" name="donarseBaixa" class="btn btn-warning" style="height: 34px; width: 200px" href="{{ path('baixa_perfil') }}" >Donarse de baixa</a>#}
            
        </div>
        
        <!-- Modal donarse de baixa -->
        <div id="modal_baixa_{{ app.user.id }}" class="modal fade" tabindex="-1" role="dialog" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                        <h4 class="modal-title">Donarse de baixa</h4>
                    </div>
                    <div class="modal-body" id="baixa_body_{{app.user.id}}" >
                        <p>Segur que et vols donar de baixa?</p>
                    </div>
                    <div class="modal-footer">
                        <a href="{{path('baixa_perfil')}}" id="baixa_btn_{{ app.user.id }}" type="button" class="btn btn-primary">Si</a>
                        <button type="button" class="btn btn-default" data-dismiss="modal">No, Tancar</button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Div's de alertes al modificar la base de dades -->
        <div id="success" class="alert alert-success" ></div>
        <div id="failure" class="alert alert-danger" ></div>
        
    </div>

</form>

<script>

    $(document).ready(function() {
        $("#success").hide();
        $("#failure").hide();
        $("#checkForm").validate({
            rules: {
                user_pass: {required: true, minlength: 5},
                user_passRepeat: {required: true, equalTo: user_pass},
                user_nom: {required: true, minlength: 3, maxlength: 15},
                user_cognom: {required: true, minlength: 3, maxlength: 20},
                user_adreca: {required: true, minlength: 3, maxlength: 30},
                user_telefon: {required: true, minlength: 9, maxlength: 11, number: true},
                user_email: {required: true, email: true},
                user_presentacio: {required: true, minlength: 1, maxlength: 100}
            },
            messages: {
                user_pass: {
                    required: "El password no pot estar en blanc",
                    minlength: "El password ha de ser minim de 8 caracters"
                },
                user_passRepeat: {
                    required: "Has de confirmar el password",
                    equalTo: "Els passwords no coincideixen"
                },
                user_nom: {
                    required: "El nom no pot estar en blanc",
                    minlength: "El nom ha de tenir un minim de 3 caracters",
                    maxlength: "El nom ha de tenir un màxim de 15 caracters"
                },
                user_cognom: {
                    required: "El cognom no pot estar en blanc",
                    minlength: "El cognom ha de tenir un minim de 3 caracters",
                    maxlength: "El cognom ha de tenir un màxim de 20 caracters"
                },
                user_adreca: {
                    required: "L'adreça no pot estar en blanc",
                    minlength: "L'adreça ha de tenir un minim de 3 caracters",
                    maxlength: "L'adreça ha de tenir un màxim de 50 caracters"
                },
                user_telefon: {
                    required: "El telefon no pot estar en blanc",
                    minlength: "El telefon ha de tenir un minim de 9 caracters",
                    maxlength: "El telefon ha de tenir un màxim de 11 caracters",
                    number: "El telefon ha de ser numeric"
                },
                user_email: "Ha de ser un email vàlid",
                user_presentacio: {
                    minlength: "Estaria bé tenir una presentació",
                    maxlenght: "La teva presentació es masa llarga"
                }
            },
            submitHandler: function(form) {
                var dataString = 'password=' + $('#user_pass').val() + '&nom=' + $('#user_nom').val() + '&cognom=' + $('#user_cognom').val() + '&adreca=' + $('#user_adreca').val() + '&telefon=' + $('#user_telefon').val() + '&email=' + $('#user_email').val() + '&presentacio=' + $('#user_presentacio').val();
                $.ajax({
                    type: "POST",
                    url: "{{ path('perfil_user') }}",
                    data: dataString,
                    success: function(data) {
                        if (data === '{"responseCode":200}') {
                            $("#success").html("S'ha modificat amb exit").show().fadeOut(6000);
                        } else {
                            $("#failure").html("Error al modificar el perfil").show().fadeOut(6000);
                        }
                    }
                });
            }
        });
    });

</script>

{% endblock %}